<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - Z140 MDIS Driver - z140_drv.c Source File</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;"></a>
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">Z140 MDIS Driver &nbsp; </h1>
	<h3>z140_drv.c Source File</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>z140_drv.c</h1><a href="z140__drv_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*********************  P r o g r a m  -  M o d u l e ***********************/</span>
00015  <span class="comment">/*-------------------------------[ History ]--------------------------------</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * $Log: z140_drv.c,v $</span>
00018 <span class="comment"> *---------------------------------------------------------------------------</span>
00019 <span class="comment"> * (c) Copyright 2016 by MEN Mikro Elektronik GmbH, Nuernberg, Germany</span>
00020 <span class="comment"> ****************************************************************************/</span>
00021 
<a name="l00022"></a><a class="code" href="z140__drv_8c.html#a0">00022</a> <span class="preprocessor">#define _NO_LL_HANDLE        </span><span class="comment">/* ll_defs.h: don't define LL_HANDLE struct */</span>
00023 
00024 <span class="comment">/*-----------------------------------------+</span>
00025 <span class="comment">|  INCLUDES                                |</span>
00026 <span class="comment">+-----------------------------------------*/</span>
00027 <span class="preprocessor">#include &lt;MEN/men_typs.h&gt;</span>    <span class="comment">/* system dependent definitions   */</span>
00028 <span class="preprocessor">#include &lt;MEN/maccess.h&gt;</span>     <span class="comment">/* hw access macros and types     */</span>
00029 <span class="preprocessor">#include &lt;MEN/dbg.h&gt;</span>         <span class="comment">/* debug functions                */</span>
00030 <span class="preprocessor">#include &lt;MEN/oss.h&gt;</span>         <span class="comment">/* oss functions                  */</span>
00031 <span class="preprocessor">#include &lt;MEN/desc.h&gt;</span>        <span class="comment">/* descriptor functions           */</span>
00032 <span class="preprocessor">#include &lt;MEN/mdis_api.h&gt;</span>    <span class="comment">/* MDIS global defs               */</span>
00033 <span class="preprocessor">#include &lt;MEN/mdis_com.h&gt;</span>    <span class="comment">/* MDIS common defs               */</span>
00034 <span class="preprocessor">#include &lt;MEN/mdis_err.h&gt;</span>    <span class="comment">/* MDIS error codes               */</span>
00035 <span class="preprocessor">#include &lt;MEN/ll_defs.h&gt;</span>     <span class="comment">/* low-level driver definitions   */</span>
00036 <span class="preprocessor">#include &lt;MEN/z140_reg.h&gt;</span>    <span class="comment">/* 16Z140 IP core reg definitions */</span>
00037 <span class="preprocessor">#include &lt;MEN/chameleon.h&gt;</span>   <span class="comment">/* chameleon header               */</span>
00038 
00039 <span class="comment">/*-----------------------------------------+</span>
00040 <span class="comment">|  DEFINES                                 |</span>
00041 <span class="comment">+-----------------------------------------*/</span>
00042 
00043 <span class="comment">/* general defines */</span>
<a name="l00044"></a><a class="code" href="z140__drv_8c.html#a1">00044</a> <span class="preprocessor">#define CH_NUMBER          1          </span>
<a name="l00045"></a><a class="code" href="z140__drv_8c.html#a2">00045</a> <span class="preprocessor">#define USE_IRQ            FALSE      </span>
<a name="l00046"></a><a class="code" href="z140__drv_8c.html#a3">00046</a> <span class="preprocessor">#define ADDRSPACE_COUNT    1          </span>
<a name="l00047"></a><a class="code" href="z140__drv_8c.html#a4">00047</a> <span class="preprocessor">#define ADDRSPACE_SIZE     0x2C       </span>
00049 <span class="preprocessor"></span><span class="comment">/* debug defines */</span>
<a name="l00050"></a><a class="code" href="z140__drv_8c.html#a5">00050</a> <span class="preprocessor">#define DBG_MYLEVEL        llHdl-&gt;dbgLevel    </span>
<a name="l00051"></a><a class="code" href="z140__drv_8c.html#a6">00051</a> <span class="preprocessor">#define DBH                llHdl-&gt;dbgHdl      </span>
<a name="l00052"></a><a class="code" href="z140__drv_8c.html#a7">00052</a> <span class="preprocessor">#define OSH                llHdl-&gt;osHdl       </span>
00054 <span class="preprocessor"></span><span class="comment">/* default defines (for internal pattern generator usage) */</span>
<a name="l00055"></a><a class="code" href="z140__drv_8c.html#a8">00055</a> <span class="preprocessor">#define DEBOUNCE_TIME_DEF     5     </span>
<a name="l00056"></a><a class="code" href="z140__drv_8c.html#a9">00056</a> <span class="preprocessor">#define MEAS_TOUT_DEF       100     </span>
<a name="l00057"></a><a class="code" href="z140__drv_8c.html#a10">00057</a> <span class="preprocessor">#define ROLLING_TIME_DEF     10     </span>
<a name="l00058"></a><a class="code" href="z140__drv_8c.html#a11">00058</a> <span class="preprocessor">#define STANDSTILL_TIME_DEF  20     </span>
<a name="l00059"></a><a class="code" href="z140__drv_8c.html#a12">00059</a> <span class="preprocessor">#define DIRDET_TOUT_DEF     100     </span>
00061 <span class="preprocessor"></span><span class="comment">/*-----------------------------------------+</span>
00062 <span class="comment">|  TYPEDEFS                                |</span>
00063 <span class="comment">+-----------------------------------------*/</span>
00064 
<a name="l00065"></a><a class="code" href="structLL__HANDLE.html">00065</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00066     <span class="comment">/* general */</span>
<a name="l00067"></a><a class="code" href="structLL__HANDLE.html#o0">00067</a>     int32                   memAlloc;       
<a name="l00068"></a><a class="code" href="structLL__HANDLE.html#o1">00068</a>     OSS_HANDLE              *osHdl;         
<a name="l00069"></a><a class="code" href="structLL__HANDLE.html#o2">00069</a>     OSS_IRQ_HANDLE          *irqHdl;        
<a name="l00070"></a><a class="code" href="structLL__HANDLE.html#o3">00070</a>     DESC_HANDLE             *descHdl;       
<a name="l00071"></a><a class="code" href="structLL__HANDLE.html#o4">00071</a>     MACCESS                 ma;             
<a name="l00072"></a><a class="code" href="structLL__HANDLE.html#o5">00072</a>     MDIS_IDENT_FUNCT_TBL    idFuncTbl;      
00073     <span class="comment">/* debug */</span>
<a name="l00074"></a><a class="code" href="structLL__HANDLE.html#o6">00074</a>     u_int32                 dbgLevel;       
<a name="l00075"></a><a class="code" href="structLL__HANDLE.html#o7">00075</a>     DBG_HANDLE              *dbgHdl;        
00076 } <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>;
00077 
00078 <span class="comment">/* include files which need LL_HANDLE */</span>
00079 <span class="preprocessor">#include &lt;MEN/ll_entry.h&gt;</span>       <span class="comment">/* low-level driver jump table */</span>
00080 <span class="preprocessor">#include &lt;<a class="code" href="z140__drv_8h.html">MEN/z140_drv.h</a>&gt;</span>       <span class="comment">/* Z140 driver header file      */</span>
00081 
00082 <span class="comment">/*-----------------------------------------+</span>
00083 <span class="comment">|  PROTOTYPES                              |</span>
00084 <span class="comment">+-----------------------------------------*/</span>
00085 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a13">Z140_Init</a>(DESC_SPEC *descSpec, OSS_HANDLE *osHdl,
00086                         MACCESS *ma, OSS_SEM_HANDLE *devSemHdl,
00087                         OSS_IRQ_HANDLE *irqHdl, <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> **llHdlP);
00088 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a14">Z140_Exit</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> **llHdlP);
00089 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a15">Z140_Read</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, int32 *value);
00090 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a16">Z140_Write</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, int32 value);
00091 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a17">Z140_SetStat</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,int32 ch, int32 code,
00092                             INT32_OR_64 value32_or_64);
00093 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a18">Z140_GetStat</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, int32 code,
00094                             INT32_OR_64 *value32_or64P);
00095 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a19">Z140_BlockRead</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, <span class="keywordtype">void</span> *buf, int32 size,
00096                             int32 *nbrRdBytesP);
00097 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a20">Z140_BlockWrite</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, <span class="keywordtype">void</span> *buf, int32 size,
00098                                 int32 *nbrWrBytesP);
00099     <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a21">Z140_Irq</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl);
00100 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a22">Z140_Info</a>(int32 infoType, ...);
00101 <span class="keyword">static</span> <span class="keywordtype">char</span>* <a class="code" href="z140__drv_8c.html#a23">Ident</a>(<span class="keywordtype">void</span>);
00102 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 retCode);
00103 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a25">SetDebounceTime</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, u_int32 value);
00104 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a26">SetMeasTout</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, u_int32 value);
00105 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a27">SetRollingTime</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, u_int32 value);
00106 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a28">SetStandstillTime</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, u_int32 value);
00107 <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a29">SetDirdetTout</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, u_int32 value);
00108 
00109 <span class="comment">/****************************** Z140_GetEntry ********************************/</span>
00114 <span class="preprocessor">#ifdef _ONE_NAMESPACE_PER_DRIVER_</span>
00115 <span class="preprocessor"></span>    <span class="keyword">extern</span> <span class="keywordtype">void</span> LL_GetEntry(
00116         LL_ENTRY* drvP
00117     )
00118 #<span class="keywordflow">else</span>
<a name="l00119"></a><a class="code" href="z140__drv_8c.html#a30">00119</a>     <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="z140__drv_8h.html#a29">__Z140_GetEntry</a>(
00120         LL_ENTRY* drvP
00121     )
00122 #endif
00123 {
00124     drvP-&gt;init        = <a class="code" href="z140__drv_8c.html#a13">Z140_Init</a>;
00125     drvP-&gt;exit        = <a class="code" href="z140__drv_8c.html#a14">Z140_Exit</a>;
00126     drvP-&gt;read        = <a class="code" href="z140__drv_8c.html#a15">Z140_Read</a>;
00127     drvP-&gt;write       = <a class="code" href="z140__drv_8c.html#a16">Z140_Write</a>;
00128     drvP-&gt;blockRead   = <a class="code" href="z140__drv_8c.html#a19">Z140_BlockRead</a>;
00129     drvP-&gt;blockWrite  = <a class="code" href="z140__drv_8c.html#a20">Z140_BlockWrite</a>;
00130     drvP-&gt;setStat     = <a class="code" href="z140__drv_8c.html#a17">Z140_SetStat</a>;
00131     drvP-&gt;getStat     = <a class="code" href="z140__drv_8c.html#a18">Z140_GetStat</a>;
00132     drvP-&gt;irq         = <a class="code" href="z140__drv_8c.html#a21">Z140_Irq</a>;
00133     drvP-&gt;info        = <a class="code" href="z140__drv_8c.html#a22">Z140_Info</a>;
00134 }
00135 
00136 <span class="comment">/******************************** Z140_Init **********************************/</span>
<a name="l00166"></a><a class="code" href="z140__drv_8c.html#a13">00166</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a13">Z140_Init</a>(
00167     DESC_SPEC       *descP,
00168     OSS_HANDLE      *osHdl,
00169     MACCESS         *ma,
00170     OSS_SEM_HANDLE  *devSemHdl,
00171     OSS_IRQ_HANDLE  *irqHdl,
00172     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>       **llHdlP
00173 )
00174 {
00175     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl = NULL;
00176     u_int32 gotsize;
00177     int32 error;
00178     u_int32 value;
00179     u_int32 debounceTime;   
00180     u_int32 measTout;       
00181     u_int32 rollingTime;    
00182     u_int32 standstillTime; 
00183     u_int32 dirdetTout;     
00184 
00185     <span class="comment">/*------------------------------+</span>
00186 <span class="comment">    |  prepare the handle           |</span>
00187 <span class="comment">    +------------------------------*/</span>
00188     *llHdlP = NULL;     <span class="comment">/* set low-level driver handle to NULL */</span>
00189 
00190     <span class="comment">/* alloc */</span>
00191     <span class="keywordflow">if</span> ((llHdl = (<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>*)OSS_MemGet(
00192                     osHdl, <span class="keyword">sizeof</span>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>), &amp;gotsize)) == NULL)
00193         <span class="keywordflow">return</span> (ERR_OSS_MEM_ALLOC);
00194 
00195     <span class="comment">/* clear */</span>
00196     OSS_MemFill(osHdl, gotsize, (<span class="keywordtype">char</span>*)llHdl, 0x00);
00197 
00198     <span class="comment">/* init */</span>
00199     llHdl-&gt;memAlloc    = gotsize;
00200     llHdl-&gt;osHdl       = osHdl;
00201     llHdl-&gt;irqHdl      = irqHdl;
00202     llHdl-&gt;ma          = *ma;
00203 
00204     <span class="comment">/*------------------------------+</span>
00205 <span class="comment">    |  init id function table       |</span>
00206 <span class="comment">    +------------------------------*/</span>
00207     <span class="comment">/* driver's ident function */</span>
00208     llHdl-&gt;idFuncTbl.idCall[0].identCall = <a class="code" href="z140__drv_8c.html#a23">Ident</a>;
00209     <span class="comment">/* library's ident functions */</span>
00210     llHdl-&gt;idFuncTbl.idCall[1].identCall = DESC_Ident;
00211     llHdl-&gt;idFuncTbl.idCall[2].identCall = OSS_Ident;
00212     <span class="comment">/* terminator */</span>
00213     llHdl-&gt;idFuncTbl.idCall[3].identCall = NULL;
00214 
00215     <span class="comment">/*------------------------------+</span>
00216 <span class="comment">    |  prepare debugging            |</span>
00217 <span class="comment">    +------------------------------*/</span>
00218     <a class="code" href="z140__drv_8c.html#a5">DBG_MYLEVEL</a> = OSS_DBG_DEFAULT;      <span class="comment">/* set OS specific debug level */</span>
00219     DBGINIT((NULL,&amp;<a class="code" href="z140__drv_8c.html#a6">DBH</a>));
00220 
00221     <span class="comment">/*------------------------------+</span>
00222 <span class="comment">    |  scan descriptor              |</span>
00223 <span class="comment">    +------------------------------*/</span>
00224     <span class="keywordflow">if</span> ((error = DESC_Init(descP, osHdl, &amp;llHdl-&gt;descHdl)))
00225         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00226 
00227     <span class="comment">/* DEBUG_LEVEL_DESC */</span>
00228     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, OSS_DBG_DEFAULT,
00229                                 &amp;value, <span class="stringliteral">"DEBUG_LEVEL_DESC"</span>)) &amp;&amp;
00230         error != ERR_DESC_KEY_NOTFOUND)
00231         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00232 
00233     DESC_DbgLevelSet(llHdl-&gt;descHdl, value);
00234 
00235     <span class="comment">/* DEBUG_LEVEL */</span>
00236     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, OSS_DBG_DEFAULT,
00237                                 &amp;llHdl-&gt;dbgLevel, <span class="stringliteral">"DEBUG_LEVEL"</span>)) &amp;&amp;
00238         error != ERR_DESC_KEY_NOTFOUND)
00239         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00240 
00241     <span class="comment">/* DEBOUNCE_TIME */</span>
00242     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, <a class="code" href="z140__drv_8c.html#a8">DEBOUNCE_TIME_DEF</a>,
00243         &amp;debounceTime, <span class="stringliteral">"DEBOUNCE_TIME"</span>)) &amp;&amp;
00244         error != ERR_DESC_KEY_NOTFOUND)
00245         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00246 
00247     <span class="comment">/* MEAS_TOUT */</span>
00248     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, <a class="code" href="z140__drv_8c.html#a9">MEAS_TOUT_DEF</a>,
00249         &amp;measTout, <span class="stringliteral">"MEAS_TOUT"</span>)) &amp;&amp;
00250         error != ERR_DESC_KEY_NOTFOUND)
00251         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00252 
00253     <span class="comment">/* ROLLING_TIME */</span>
00254     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, <a class="code" href="z140__drv_8c.html#a10">ROLLING_TIME_DEF</a>,
00255         &amp;rollingTime, <span class="stringliteral">"ROLLING_TIME"</span>)) &amp;&amp;
00256         error != ERR_DESC_KEY_NOTFOUND)
00257         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00258 
00259     <span class="comment">/* STANDSTILL_TIME */</span>
00260     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, <a class="code" href="z140__drv_8c.html#a11">STANDSTILL_TIME_DEF</a>,
00261         &amp;standstillTime, <span class="stringliteral">"STANDSTILL_TIME"</span>)) &amp;&amp;
00262         error != ERR_DESC_KEY_NOTFOUND)
00263         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00264 
00265     <span class="comment">/* DIRDET_TOUT */</span>
00266     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, <a class="code" href="z140__drv_8c.html#a12">DIRDET_TOUT_DEF</a>,
00267         &amp;dirdetTout, <span class="stringliteral">"DIRDET_TOUT"</span>)) &amp;&amp;
00268         error != ERR_DESC_KEY_NOTFOUND)
00269         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00270 
00271     <span class="comment">/*------------------------------+</span>
00272 <span class="comment">    |  init hardware                |</span>
00273 <span class="comment">    +------------------------------*/</span>
00274     <span class="comment">/* configure frequency counter IP core */</span>
00275     <span class="keywordflow">if</span> ((error = <a class="code" href="z140__drv_8c.html#a25">SetDebounceTime</a>(llHdl, debounceTime)))
00276         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00277 
00278     <span class="keywordflow">if</span> ((error = <a class="code" href="z140__drv_8c.html#a26">SetMeasTout</a>(llHdl, measTout)))
00279         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00280 
00281     <span class="keywordflow">if</span> ((error = <a class="code" href="z140__drv_8c.html#a27">SetRollingTime</a>(llHdl, rollingTime)))
00282         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00283 
00284     <span class="keywordflow">if</span> ((error = <a class="code" href="z140__drv_8c.html#a28">SetStandstillTime</a>(llHdl, standstillTime)))
00285         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00286 
00287     <span class="keywordflow">if</span> ((error = <a class="code" href="z140__drv_8c.html#a29">SetDirdetTout</a>(llHdl, dirdetTout)))
00288         <span class="keywordflow">return</span> (<a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error));
00289 
00290     <span class="comment">/* reset distance values, disable test pattern */</span>
00291     MWRITE_D32(llHdl-&gt;ma, Z140R_COMMAND, Z140R_CMD_RST_DIST);
00292 
00293     *llHdlP = llHdl;        <span class="comment">/* set low-level driver handle */</span>
00294 
00295     <span class="keywordflow">return</span> (ERR_SUCCESS);
00296 }
00297 
00298 <span class="comment">/****************************** Z140_Exit ************************************/</span>
<a name="l00307"></a><a class="code" href="z140__drv_8c.html#a14">00307</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a14">Z140_Exit</a>(
00308     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> **llHdlP
00309 )
00310 {
00311     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl = *llHdlP;
00312     int32 error = 0;
00313 
00314     DBGWRT_1((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z140_Exit\n"</span>));
00315 
00316     <span class="comment">/*------------------------------+</span>
00317 <span class="comment">    |  de-init hardware             |</span>
00318 <span class="comment">    +------------------------------*/</span>
00319     <span class="comment">/* reset distance values, disable test pattern */</span>
00320     MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>, Z140R_COMMAND, Z140R_CMD_RST_DIST);
00321 
00322     <span class="comment">/*------------------------------+</span>
00323 <span class="comment">    |  clean up memory              |</span>
00324 <span class="comment">    +------------------------------*/</span>
00325     *llHdlP = NULL;     <span class="comment">/* set low-level driver handle to NULL */</span>
00326     error = <a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(llHdl, error);
00327 
00328     <span class="keywordflow">return</span> (error);
00329 }
00330 
00331 <span class="comment">/****************************** Z140_Read ************************************/</span>
<a name="l00342"></a><a class="code" href="z140__drv_8c.html#a15">00342</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a15">Z140_Read</a>(
00343     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>  *llHdl,
00344     int32      ch,
00345     int32      *valueP
00346 )
00347 {
00348     DBGWRT_1((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z140_Read: ch=%d\n"</span>, ch));
00349 
00350     <span class="keywordflow">return</span>(ERR_LL_ILL_FUNC);
00351 }
00352 
00353 <span class="comment">/****************************** Z140_Write ***********************************/</span>
<a name="l00364"></a><a class="code" href="z140__drv_8c.html#a16">00364</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a16">Z140_Write</a>(
00365     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>  *llHdl,
00366     int32      ch,
00367     int32      value
00368 )
00369 {
00370     DBGWRT_1((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z140_Write: ch=%d  val=0x%x\n"</span>, ch, value));
00371 
00372     <span class="keywordflow">return</span>(ERR_LL_ILL_FUNC);
00373 }
00374 
00375 <span class="comment">/****************************** Z140_SetStat *********************************/</span>
<a name="l00388"></a><a class="code" href="z140__drv_8c.html#a17">00388</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a17">Z140_SetStat</a>(
00389     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00390     int32       code,
00391     int32       ch,
00392     INT32_OR_64 value32_or_64
00393 )
00394 {
00395     <span class="keywordtype">char</span> *func = <span class="stringliteral">"LL - Z140_SetStat"</span>;
00396     int32 value = (int32)value32_or_64;     <span class="comment">/* 32bit value */</span>
00397     MACCESS ma = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>;
00398     int32 error = ERR_SUCCESS;
00399 
00400     DBGWRT_1((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"%s: ch=%d code=0x%04x value=0x%x\n"</span>,
00401                 func, ch, code, value));
00402 
00403     <span class="keywordflow">switch</span> (code) {
00404         <span class="comment">/*--------------------------+</span>
00405 <span class="comment">        |  debug level              |</span>
00406 <span class="comment">        +--------------------------*/</span>
00407         <span class="keywordflow">case</span> M_LL_DEBUG_LEVEL:
00408             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o6">dbgLevel</a> = value;
00409             <span class="keywordflow">break</span>;
00410         <span class="comment">/*--------------------------+</span>
00411 <span class="comment">        |  channel direction        |</span>
00412 <span class="comment">        +--------------------------*/</span>
00413         <span class="keywordflow">case</span> M_LL_CH_DIR:
00414             <span class="keywordflow">if</span> (value != M_CH_INOUT) {
00415                 error = ERR_LL_ILL_DIR;
00416             }
00417             <span class="keywordflow">break</span>;
00418         <span class="comment">/*--------------------------+</span>
00419 <span class="comment">        |  config frequency counter |</span>
00420 <span class="comment">        +--------------------------*/</span>
00421         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a0">Z140_DEBOUNCET</a>:
00422             error = <a class="code" href="z140__drv_8c.html#a25">SetDebounceTime</a>(llHdl, value);
00423             <span class="keywordflow">break</span>;
00424 
00425         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a1">Z140_MEAS_TOUT</a>:
00426             error = <a class="code" href="z140__drv_8c.html#a26">SetMeasTout</a>(llHdl, value);
00427             <span class="keywordflow">break</span>;
00428 
00429         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a2">Z140_ROLLINGT</a>:
00430             error = <a class="code" href="z140__drv_8c.html#a27">SetRollingTime</a>(llHdl, value);
00431             <span class="keywordflow">break</span>;
00432 
00433         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a3">Z140_STANDSTILLT</a>:
00434             error = <a class="code" href="z140__drv_8c.html#a28">SetStandstillTime</a>(llHdl, value);
00435             <span class="keywordflow">break</span>;
00436 
00437         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a4">Z140_DIRDET_TOUT</a>:
00438             error = <a class="code" href="z140__drv_8c.html#a29">SetDirdetTout</a>(llHdl, value);
00439             <span class="keywordflow">break</span>;
00440         <span class="comment">/*--------------------------+</span>
00441 <span class="comment">        |  reset distance counters  |</span>
00442 <span class="comment">        +--------------------------*/</span>
00443         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a5">Z140_DISTRST</a>:
00444             MSETMASK_D32(ma, Z140R_COMMAND, Z140R_CMD_RST_DIST);
00445             <span class="keywordflow">break</span>;
00446         <span class="comment">/*--------------------------+</span>
00447 <span class="comment">        |  config test pattern gen  |</span>
00448 <span class="comment">        +--------------------------*/</span>
00449         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a6">Z140_TPATTERN</a>:
00450             <span class="keywordflow">switch</span> (value) {
00451             <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a12">Z140_TP_DISABLE</a>:
00452                 MWRITE_D32(ma, Z140R_COMMAND, 0x0);
00453                 <span class="keywordflow">break</span>;
00454             <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a13">Z140_TP_FWD</a>:
00455                 MWRITE_D32(ma, Z140R_COMMAND, Z140R_CMD_EN_TEST | Z140R_CMD_PAT_CW);
00456                 <span class="keywordflow">break</span>;
00457             <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a14">Z140_TP_BWD</a>:
00458                 MWRITE_D32(ma, Z140R_COMMAND, Z140R_CMD_EN_TEST | Z140R_CMD_PAT_CCW);
00459                 <span class="keywordflow">break</span>;
00460             <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a15">Z140_TP_STANDSTILL</a>:
00461                 MWRITE_D32(ma, Z140R_COMMAND, Z140R_CMD_EN_TEST | Z140R_CMD_PAT_SILENT);
00462                 <span class="keywordflow">break</span>;
00463             <span class="keywordflow">default</span>:
00464                 DBGWRT_ERR((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** %s(Z140_TPATTERN): illegal value %d\n"</span>, func, value));
00465                 error = ERR_LL_ILL_PARAM;
00466             }
00467             <span class="keywordflow">break</span>;          
00468         <span class="comment">/*--------------------------+</span>
00469 <span class="comment">        |  (unknown)                |</span>
00470 <span class="comment">        +--------------------------*/</span>
00471         <span class="keywordflow">default</span>:
00472             error = ERR_LL_UNK_CODE;
00473     }
00474 
00475     <span class="keywordflow">return</span> (error);
00476 }
00477 
00478 <span class="comment">/****************************** Z140_GetStat *********************************/</span>
<a name="l00494"></a><a class="code" href="z140__drv_8c.html#a18">00494</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a18">Z140_GetStat</a>(
00495     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00496     int32       code,
00497     int32       ch,
00498     INT32_OR_64 *value32_or_64P
00499 )
00500 {
00501     <span class="keywordtype">char</span> *func = <span class="stringliteral">"LL - Z140_GetStat"</span>;
00502     int32 *valueP = (int32*)value32_or_64P;     <span class="comment">/* pointer to 32bit value */</span>
00503     <a class="code" href="z140__drv_8h.html#a30">INT32_OR_64</a> *value64P = value32_or_64P;     <span class="comment">/* stores 32/64bit pointer */</span>
00504     MACCESS ma = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>;
00505     int32 error = ERR_SUCCESS;
00506     u_int32 read;
00507 
00508     DBGWRT_1((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"%s: ch=%d code=0x%04x\n"</span>, func, ch, code));
00509 
00510     <span class="keywordflow">switch</span> (code) {
00511         <span class="comment">/*--------------------------+</span>
00512 <span class="comment">        |  debug level              |</span>
00513 <span class="comment">        +--------------------------*/</span>
00514         <span class="keywordflow">case</span> M_LL_DEBUG_LEVEL:
00515             *valueP = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o6">dbgLevel</a>;
00516             <span class="keywordflow">break</span>;
00517         <span class="comment">/*--------------------------+</span>
00518 <span class="comment">        |  number of channels       |</span>
00519 <span class="comment">        +--------------------------*/</span>
00520         <span class="keywordflow">case</span> M_LL_CH_NUMBER:
00521             *valueP = <a class="code" href="z140__drv_8c.html#a1">CH_NUMBER</a>;
00522             <span class="keywordflow">break</span>;
00523         <span class="comment">/*--------------------------+</span>
00524 <span class="comment">        |  channel direction        |</span>
00525 <span class="comment">        +--------------------------*/</span>
00526         <span class="keywordflow">case</span> M_LL_CH_DIR:
00527             *valueP = M_CH_IN;
00528             <span class="keywordflow">break</span>;
00529         <span class="comment">/*--------------------------+</span>
00530 <span class="comment">        |  channel length [bits]    |</span>
00531 <span class="comment">        +--------------------------*/</span>
00532         <span class="keywordflow">case</span> M_LL_CH_LEN:
00533             *valueP = 32;
00534             <span class="keywordflow">break</span>;
00535         <span class="comment">/*--------------------------+</span>
00536 <span class="comment">        |  channel type info        |</span>
00537 <span class="comment">        +--------------------------*/</span>
00538         <span class="keywordflow">case</span> M_LL_CH_TYP:
00539             *valueP = M_CH_COUNTER;
00540             <span class="keywordflow">break</span>;
00541         <span class="comment">/*--------------------------+</span>
00542 <span class="comment">        |  ident table pointer      |</span>
00543 <span class="comment">        |  (treat as non-block!)    |</span>
00544 <span class="comment">        +--------------------------*/</span>
00545         <span class="keywordflow">case</span> M_MK_BLK_REV_ID:
00546             *value64P = (<a class="code" href="z140__drv_8h.html#a30">INT32_OR_64</a>)&amp;llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o5">idFuncTbl</a>;
00547             <span class="keywordflow">break</span>;
00548         <span class="comment">/*--------------------------+</span>
00549 <span class="comment">        |  frequency counter config |</span>
00550 <span class="comment">        +--------------------------*/</span>
00551         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a0">Z140_DEBOUNCET</a>:
00552             *valueP = MREAD_D32(ma, Z140R_DEB_TIME);
00553             <span class="keywordflow">break</span>;
00554 
00555         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a1">Z140_MEAS_TOUT</a>:
00556             *valueP = 100 * MREAD_D32(ma, Z140R_MEAS_TOUT);
00557             <span class="keywordflow">break</span>;
00558 
00559         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a2">Z140_ROLLINGT</a>:
00560             *valueP = 10 * MREAD_D32(ma, Z140R_ROLLING_TIME);
00561             <span class="keywordflow">break</span>;
00562 
00563         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a3">Z140_STANDSTILLT</a>:
00564             *valueP = 10 * MREAD_D32(ma, Z140R_STANDSTILL_TIME);
00565             <span class="keywordflow">break</span>;
00566 
00567         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a4">Z140_DIRDET_TOUT</a>:
00568             *valueP = 10 * MREAD_D32(ma, Z140R_DIR_DET_TOUT);
00569             <span class="keywordflow">break</span>;
00570         <span class="comment">/*--------------------------+</span>
00571 <span class="comment">        |  test pattern gen config  |</span>
00572 <span class="comment">        +--------------------------*/</span>
00573         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a6">Z140_TPATTERN</a>:
00574             read = MREAD_D32(ma, Z140R_COMMAND);
00575 
00576             <span class="comment">/* enabled */</span>
00577             <span class="keywordflow">if</span> ((read &amp; Z140R_CMD_EN_TEST)) {
00578 
00579                 read &amp;= Z140R_CMD_PAT_MASK;
00580                 
00581                 <span class="keywordflow">switch</span> (read) {
00582                 <span class="keywordflow">case</span> Z140R_CMD_PAT_CW:
00583                     *valueP = <a class="code" href="z140__drv_8h.html#a13">Z140_TP_FWD</a>;
00584                     <span class="keywordflow">break</span>;
00585                 <span class="keywordflow">case</span> Z140R_CMD_PAT_CCW:
00586                     *valueP = <a class="code" href="z140__drv_8h.html#a14">Z140_TP_BWD</a>;
00587                     <span class="keywordflow">break</span>;
00588                 <span class="keywordflow">case</span> Z140R_CMD_PAT_SILENT:
00589                     *valueP = <a class="code" href="z140__drv_8h.html#a15">Z140_TP_STANDSTILL</a>;
00590                     <span class="keywordflow">break</span>;
00591                 <span class="keywordflow">default</span>:
00592                     *valueP = <a class="code" href="z140__drv_8h.html#a12">Z140_TP_DISABLE</a>;
00593                     DBGWRT_ERR((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** %s(Z140_TPATTERN): illegal value %d\n"</span>, func, read));
00594                     error = ERR_LL_ILL_PARAM;
00595                 }
00596 
00597             }
00598             <span class="comment">/* disabled */</span>
00599             <span class="keywordflow">else</span> {
00600                 *valueP = <a class="code" href="z140__drv_8h.html#a12">Z140_TP_DISABLE</a>;
00601             }
00602             <span class="keywordflow">break</span>;
00603         <span class="comment">/*--------------------------+</span>
00604 <span class="comment">        |  period measurement       |</span>
00605 <span class="comment">        +--------------------------*/</span>
00606         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a7">Z140_PERIOD_A</a>:
00607         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a8">Z140_PERIOD_B</a>:
00608             <span class="keywordflow">if</span>(code == <a class="code" href="z140__drv_8h.html#a7">Z140_PERIOD_A</a>)
00609                 read = MREAD_D32(ma, Z140R_PERIOD_A);
00610             <span class="keywordflow">else</span>
00611                 read = MREAD_D32(ma, Z140R_PERIOD_B);
00612 
00613             <span class="comment">/* return always period value */</span>
00614             *valueP = read &amp; Z140R_PERIOD_MASK;
00615 
00616             <span class="comment">/* no new period value since last read? */</span>
00617             <span class="keywordflow">if</span>(!(read &amp; Z140R_PERIOD_NEW))
00618                 error = <a class="code" href="z140__drv_8h.html#a25">Z140_ERR_NO_DATA</a>;
00619             <span class="comment">/* signal phase length violation? */</span>
00620             <span class="keywordflow">else</span> <span class="keywordflow">if</span>((read &amp; Z140R_PERIOD_LSTS))
00621                 error = <a class="code" href="z140__drv_8h.html#a24">Z140_ERR_PH_VIOLATION</a>;
00622             <span class="comment">/* signal period invalid? */</span>
00623             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!(read &amp; Z140R_PERIOD_VLD))
00624                 error = <a class="code" href="z140__drv_8h.html#a23">Z140_ERR_PER_INVALID</a>;
00625             
00626             <span class="keywordflow">break</span>;
00627         <span class="comment">/*--------------------------+</span>
00628 <span class="comment">        |  distance pulses          |</span>
00629 <span class="comment">        +--------------------------*/</span>
00630         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a9">Z140_DISTANCE_FWD</a>:
00631             *valueP = MREAD_D32(ma, Z140R_DISTANCE_FWD);
00632             <span class="keywordflow">break</span>;
00633         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a10">Z140_DISTANCE_BWD</a>:
00634             *valueP = MREAD_D32(ma, Z140R_DISTANCE_BWD);
00635             <span class="keywordflow">break</span>;
00636         <span class="comment">/*--------------------------+</span>
00637 <span class="comment">        |  status                   |</span>
00638 <span class="comment">        +--------------------------*/</span>
00639         <span class="keywordflow">case</span> <a class="code" href="z140__drv_8h.html#a11">Z140_STATUS</a>:
00640             *valueP = MREAD_D32(ma, Z140R_STATUS);
00641             <span class="keywordflow">break</span>;
00642         <span class="comment">/*--------------------------+</span>
00643 <span class="comment">        |  (unknown)                |</span>
00644 <span class="comment">        +--------------------------*/</span>
00645         <span class="keywordflow">default</span>:
00646             error = ERR_LL_UNK_CODE;
00647     }
00648 
00649     <span class="keywordflow">return</span> (error);
00650 }
00651 
00652 <span class="comment">/******************************* Z140_BlockRead ******************************/</span>
<a name="l00665"></a><a class="code" href="z140__drv_8c.html#a19">00665</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a19">Z140_BlockRead</a>(
00666     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,
00667     int32     ch,
00668     <span class="keywordtype">void</span>      *buf,
00669     int32     size,
00670     int32     *nbrRdBytesP
00671 )
00672 {
00673     DBGWRT_1((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z140_BlockRead: ch=%d, size=%d\n"</span>, ch, size));
00674 
00675     <span class="comment">/* return number of read bytes */</span>
00676     *nbrRdBytesP = 0;
00677 
00678     <span class="keywordflow">return</span> (ERR_LL_ILL_FUNC);
00679 }
00680 
00681 <span class="comment">/****************************** Z140_BlockWrite *****************************/</span>
<a name="l00694"></a><a class="code" href="z140__drv_8c.html#a20">00694</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a20">Z140_BlockWrite</a>(
00695     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,
00696     int32     ch,
00697     <span class="keywordtype">void</span>      *buf,
00698     int32     size,
00699     int32     *nbrWrBytesP
00700 )
00701 {
00702     DBGWRT_1((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z140_BlockWrite: ch=%d, size=%d\n"</span>, ch, size));
00703 
00704     <span class="comment">/* return number of written bytes */</span>
00705     *nbrWrBytesP = 0;
00706 
00707     <span class="keywordflow">return</span> (ERR_LL_ILL_FUNC);
00708 }
00709 
00710 <span class="comment">/****************************** Z140_Irq ************************************/</span>
<a name="l00724"></a><a class="code" href="z140__drv_8c.html#a21">00724</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a21">Z140_Irq</a>(
00725     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl
00726 )
00727 {
00728     <span class="keywordflow">return</span> (LL_IRQ_DEV_NOT);
00729 }
00730 
00731 <span class="comment">/****************************** Z140_Info ***********************************/</span>
<a name="l00769"></a><a class="code" href="z140__drv_8c.html#a22">00769</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a22">Z140_Info</a>(
00770     int32 infoType,
00771     ...
00772 )
00773 {
00774     int32   error = ERR_SUCCESS;
00775     va_list argptr;
00776 
00777     va_start(argptr, infoType);
00778 
00779     <span class="keywordflow">switch</span> (infoType) {
00780         <span class="comment">/*-------------------------------+</span>
00781 <span class="comment">        |  hardware characteristics      |</span>
00782 <span class="comment">        |  (all addr/data modes ORed)    |</span>
00783 <span class="comment">        +-------------------------------*/</span>
00784         <span class="keywordflow">case</span> LL_INFO_HW_CHARACTER:
00785         {
00786             u_int32 *addrModeP = va_arg(argptr, u_int32*);
00787             u_int32 *dataModeP = va_arg(argptr, u_int32*);
00788         
00789             *addrModeP = MDIS_MA08;
00790             *dataModeP = MDIS_MD08 | MDIS_MD16;
00791             <span class="keywordflow">break</span>;
00792         }
00793         <span class="comment">/*-------------------------------+</span>
00794 <span class="comment">        |  nr of required address spaces |</span>
00795 <span class="comment">        |  (total spaces used)           |</span>
00796 <span class="comment">        +-------------------------------*/</span>
00797         <span class="keywordflow">case</span> LL_INFO_ADDRSPACE_COUNT:
00798         {
00799             u_int32 *nbrOfAddrSpaceP = va_arg(argptr, u_int32*);
00800         
00801             *nbrOfAddrSpaceP = <a class="code" href="z140__drv_8c.html#a3">ADDRSPACE_COUNT</a>;
00802             <span class="keywordflow">break</span>;
00803         }
00804         <span class="comment">/*-------------------------------+</span>
00805 <span class="comment">        |  address space type            |</span>
00806 <span class="comment">        |  (widest used data mode)       |</span>
00807 <span class="comment">        +-------------------------------*/</span>
00808         <span class="keywordflow">case</span> LL_INFO_ADDRSPACE:
00809         {
00810             u_int32 addrSpaceIndex = va_arg(argptr, u_int32);
00811             u_int32 *addrModeP = va_arg(argptr, u_int32*);
00812             u_int32 *dataModeP = va_arg(argptr, u_int32*);
00813             u_int32 *addrSizeP = va_arg(argptr, u_int32*);
00814         
00815             <span class="keywordflow">if</span> (addrSpaceIndex &gt;= <a class="code" href="z140__drv_8c.html#a3">ADDRSPACE_COUNT</a>)
00816                 error = ERR_LL_ILL_PARAM;
00817             <span class="keywordflow">else</span> {
00818                 *addrModeP = MDIS_MA08;
00819                 *dataModeP = MDIS_MD16;
00820                 *addrSizeP = <a class="code" href="z140__drv_8c.html#a4">ADDRSPACE_SIZE</a>;
00821             }
00822 
00823             <span class="keywordflow">break</span>;
00824         }
00825         <span class="comment">/*-------------------------------+</span>
00826 <span class="comment">        |  interrupt required            |</span>
00827 <span class="comment">        +-------------------------------*/</span>
00828         <span class="keywordflow">case</span> LL_INFO_IRQ:
00829         {
00830             u_int32 *useIrqP = va_arg(argptr, u_int32*);
00831 
00832             *useIrqP = <a class="code" href="z140__drv_8c.html#a2">USE_IRQ</a>;
00833             <span class="keywordflow">break</span>;
00834         }
00835         <span class="comment">/*-------------------------------+</span>
00836 <span class="comment">        |  process lock mode             |</span>
00837 <span class="comment">        +-------------------------------*/</span>
00838         <span class="keywordflow">case</span> LL_INFO_LOCKMODE:
00839         {
00840             u_int32 *lockModeP = va_arg(argptr, u_int32*);
00841 
00842             *lockModeP = LL_LOCK_CALL;
00843             <span class="keywordflow">break</span>;
00844         }
00845         <span class="comment">/*-------------------------------+</span>
00846 <span class="comment">        |  (unknown)                     |</span>
00847 <span class="comment">        +-------------------------------*/</span>
00848         <span class="keywordflow">default</span>:
00849             error = ERR_LL_ILL_PARAM;
00850     }
00851 
00852     va_end(argptr);
00853 
00854     <span class="keywordflow">return</span> (error);
00855 }
00856 
00857 <span class="comment">/******************************** Ident ************************************/</span>
<a name="l00862"></a><a class="code" href="z140__drv_8c.html#a23">00862</a> <span class="keyword">static</span> <span class="keywordtype">char</span>* <a class="code" href="z140__drv_8c.html#a23">Ident</a>(<span class="keywordtype">void</span>)
00863 {
00864     <span class="keywordflow">return</span> (<span class="stringliteral">"Z140 - Z140 low level driver: $Id: z140_drv.c,v $"</span>);
00865 }
00866 
00867 <span class="comment">/********************************* Cleanup *********************************/</span>
<a name="l00877"></a><a class="code" href="z140__drv_8c.html#a24">00877</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a24">Cleanup</a>(
00878     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,
00879     int32     retCode
00880 )
00881 {
00882     <span class="comment">/*------------------------------+</span>
00883 <span class="comment">    |  close handles                |</span>
00884 <span class="comment">    +------------------------------*/</span>
00885     <span class="comment">/* clean up desc */</span>
00886     <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o3">descHdl</a>)
00887         DESC_Exit(&amp;llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o3">descHdl</a>);
00888 
00889     <span class="comment">/* clean up debug */</span>
00890     DBGEXIT((&amp;<a class="code" href="z140__drv_8c.html#a6">DBH</a>));
00891 
00892     <span class="comment">/*------------------------------+</span>
00893 <span class="comment">    |  free memory                  |</span>
00894 <span class="comment">    +------------------------------*/</span>
00895     <span class="comment">/* free my handle */</span>
00896     OSS_MemFree(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o1">osHdl</a>, (int8*)llHdl, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o0">memAlloc</a>);
00897 
00898     <span class="comment">/*return error code */</span>
00899     <span class="keywordflow">return</span> (retCode);
00900 }
00901 
00902 <span class="comment">/******************************************************************************/</span>
<a name="l00910"></a><a class="code" href="z140__drv_8c.html#a25">00910</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a25">SetDebounceTime</a>(
00911     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00912     u_int32     value
00913 )
00914 {
00915     <span class="comment">/* check range */</span>
00916     <span class="keywordflow">if</span> (!IN_RANGE(value, 0, 255)) {
00917         DBGWRT_ERR((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - SetDebounceTime(): illegal value %d\n"</span>, value));
00918         <span class="keywordflow">return</span> ERR_LL_ILL_PARAM;
00919     }
00920 
00921     DBGWRT_2((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">" SetDebounceTime %dus\n"</span>,value));
00922     MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>, Z140R_DEB_TIME, value);
00923 
00924     <span class="keywordflow">return</span> ERR_SUCCESS;
00925 }
00926 
00927 <span class="comment">/******************************************************************************/</span>
<a name="l00935"></a><a class="code" href="z140__drv_8c.html#a26">00935</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a26">SetMeasTout</a>(
00936     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00937     u_int32     value
00938 )
00939 {
00940     <span class="comment">/* check range */</span>
00941     <span class="keywordflow">if</span> (!IN_RANGE(value, 100, 10000) || (value % 100)) {
00942         DBGWRT_ERR((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - SetMeasTout(): illegal value %d\n"</span>, value));
00943         <span class="keywordflow">return</span> ERR_LL_ILL_PARAM;
00944     }
00945 
00946     DBGWRT_2((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">" SetMeasTout %dms\n"</span>, value));
00947     MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>, Z140R_MEAS_TOUT, value / 100);
00948 
00949     <span class="keywordflow">return</span> ERR_SUCCESS;
00950 }
00951 
00952 <span class="comment">/******************************************************************************/</span>
<a name="l00960"></a><a class="code" href="z140__drv_8c.html#a27">00960</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a27">SetRollingTime</a>(
00961     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00962     u_int32     value
00963 )
00964 {
00965     <span class="comment">/* check range */</span>
00966     <span class="keywordflow">if</span> (!IN_RANGE(value, 10, 2550) || (value % 10)) {
00967         DBGWRT_ERR((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - SetRollingTime(): illegal value %d\n"</span>, value));
00968         <span class="keywordflow">return</span> ERR_LL_ILL_PARAM;
00969     }
00970 
00971     DBGWRT_2((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">" SetRollingTime %dms\n"</span>, value));
00972     MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>, Z140R_ROLLING_TIME, value / 10);
00973 
00974     <span class="keywordflow">return</span> ERR_SUCCESS;
00975 }
00976 
00977 <span class="comment">/******************************************************************************/</span>
<a name="l00985"></a><a class="code" href="z140__drv_8c.html#a28">00985</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a28">SetStandstillTime</a>(
00986     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00987     u_int32     value
00988 )
00989 {
00990     <span class="comment">/* check range */</span>
00991     <span class="keywordflow">if</span> (!IN_RANGE(value, 10, 2550) || (value % 10)) {
00992         DBGWRT_ERR((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - SetStandstillTime(): illegal value %d\n"</span>, value));
00993         <span class="keywordflow">return</span> ERR_LL_ILL_PARAM;
00994     }
00995 
00996     DBGWRT_2((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">" SetStandstillTime %dms\n"</span>, value));
00997     MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>, Z140R_STANDSTILL_TIME, value / 10);
00998 
00999     <span class="keywordflow">return</span> ERR_SUCCESS;
01000 }
01001 
01002 <span class="comment">/******************************************************************************/</span>
<a name="l01010"></a><a class="code" href="z140__drv_8c.html#a29">01010</a> <span class="keyword">static</span> int32 <a class="code" href="z140__drv_8c.html#a29">SetDirdetTout</a>(
01011     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
01012     u_int32     value
01013 )
01014 {
01015     <span class="comment">/* check range */</span>
01016     <span class="keywordflow">if</span> (!IN_RANGE(value, 10, 2550) || (value % 10)) {
01017         DBGWRT_ERR((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - SetDirdetTout(): illegal value %d\n"</span>, value));
01018         <span class="keywordflow">return</span> ERR_LL_ILL_PARAM;
01019     }
01020 
01021     DBGWRT_2((<a class="code" href="z140__drv_8c.html#a6">DBH</a>, <span class="stringliteral">" SetDirdetTout %dms\n"</span>, value));
01022     MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#o4">ma</a>, Z140R_DIR_DET_TOUT, value / 10);
01023 
01024     <span class="keywordflow">return</span> ERR_SUCCESS;
01025 }
01026 
</pre></div>
	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for Z140 MDIS Driver using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2016 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

